@model QuanLiKhachSan.ViewModels.Admin.UsersViewModel
@{
    ViewData["Title"] = "Quản lý khách hàng";
    Layout = "_AdminLayout";
}

<div class="admin-users">
    <!-- Page Header -->
    <div class="page-header mb-4">
        <div class="d-flex align-items-center justify-content-between">
            <h1 class="h3 mb-0">Quản lý khách hàng</h1>
            <div class="page-actions">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                    <i class="fas fa-plus me-1"></i> Thêm khách hàng mới
                </button>
            </div>
        </div>
    </div>

    <!-- User Stats Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card status-card h-100 active-users">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h6 class="status-title">Người dùng đang hoạt động</h6>
                            <h3 class="status-value">458</h3>
                        </div>
                        <div class="status-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card status-card h-100 new-users">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h6 class="status-title">Người dùng mới (30 ngày)</h6>
                            <h3 class="status-value">48</h3>
                        </div>
                        <div class="status-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card status-card h-100 vip-users">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h6 class="status-title">Khách hàng VIP</h6>
                            <h3 class="status-value">23</h3>
                        </div>
                        <div class="status-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card status-card h-100 inactive-users">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h6 class="status-title">Tài khoản bị khóa</h6>
                            <h3 class="status-value">7</h3>
                        </div>
                        <div class="status-icon">
                            <i class="fas fa-user-lock"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search & Filter Bar -->
    <div class="card mb-4">
        <div class="card-body">
            <form id="userSearchForm" class="user-search-form">
                <div class="row g-3">
                    <div class="col-lg-3 col-md-6">
                        <input type="text" class="form-control" placeholder="Tên khách hàng" name="name">
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <input type="email" class="form-control" placeholder="Email" name="email">
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <input type="tel" class="form-control" placeholder="Số điện thoại" name="phone">
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <select class="form-select" name="status">
                            <option value="">Tất cả trạng thái</option>
                            <option value="active">Đang hoạt động</option>
                            <option value="inactive">Bị khóa</option>
                            <option value="pending">Chưa xác thực</option>
                        </select>
                    </div>
                    <div class="col-lg-2 col-md-12">
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search me-1"></i> Tìm kiếm
                            </button>
                            <button type="reset" class="btn btn-outline-secondary">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Users Table -->
    <div class="card">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Danh sách khách hàng</h5>
                <div class="d-flex">
                    <div class="dropdown me-2">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-download me-1"></i> Xuất
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="exportDropdown">
                            <li><a class="dropdown-item" href="#"><i class="far fa-file-excel me-2"></i>Excel</a></li>
                            <li><a class="dropdown-item" href="#"><i class="far fa-file-pdf me-2"></i>PDF</a></li>
                            <li><a class="dropdown-item" href="#"><i class="far fa-file-csv me-2"></i>CSV</a></li>
                        </ul>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="selectAll">
                                </div>
                            </th>
                            <th scope="col">Khách hàng</th>
                            <th scope="col">Email</th>
                            <th scope="col">Số điện thoại</th>
                            <th scope="col">Ngày đăng ký</th>
                            <th scope="col">Đặt phòng</th>
                            <th scope="col">Tổng chi tiêu</th>
                            <th scope="col">Trạng thái</th>
                            <th scope="col">Loại</th>
                            <th scope="col">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model?.Users == null || !Model.Users.Any())
                        {
                            <tr>
                                <td colspan="10" class="text-center py-4">
                                    <i class="fas fa-inbox fa-2x text-muted mb-2"></i>
                                    <p class="text-muted">Không có khách hàng nào.</p>
                                </td>
                            </tr>
                        }
                        else
                        {
                            int idx = 0;
                            foreach (var u in Model.Users)
                            {
                                <tr>
                                    <td>
                                        <div class="form-check">
                                            <input class="form-check-input user-checkbox" type="checkbox" value="@u.Id" />
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle me-2">@u.Initials</div>
                                            <div>
                                                <h6 class="mb-0">@u.FullName</h6>
                                                <span class="user-id small">ID: #@u.UserId</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>@u.Email</td>
                                    <td>@u.Phone</td>
                                    <td>@u.RegisterDate.ToString("dd/MM/yyyy")</td>
                                    <td>@u.BookingsCount</td>
                                    <td>@String.Format(new System.Globalization.CultureInfo("vi-VN"), "{0:N0} VNĐ", u.TotalSpending)</td>
                                    <td>
                                        @if (u.Status == "inactive") {
                                            <span class="badge bg-danger">Bị khóa</span>
                                        } else if (u.Status == "pending") {
                                            <span class="badge bg-warning text-dark">Chưa xác thực</span>
                                        } else {
                                            <span class="badge bg-success">Đang hoạt động</span>
                                        }
                                    </td>
                                    <td>
                                        @if (u.UserType == "vip") {
                                            <span class="badge bg-warning">VIP</span>
                                        } else {
                                            <span class="badge bg-secondary">Thường</span>
                                        }
                                    </td>
                                    <td>
                                        <div class="dropdown">
                                            <button class="btn btn-sm action-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li><a class="dropdown-item view-user" href="/Admin/Users/Details/@u.Id"><i class="fas fa-eye me-2"></i>Chi tiết</a></li>
                                                <li><a class="dropdown-item edit-user" href="/Admin/Users/Edit/@u.Id"><i class="fas fa-edit me-2"></i>Chỉnh sửa</a></li>
                                                <li><a class="dropdown-item" href="/Admin/Users/Bookings/@u.Id"><i class="fas fa-history me-2"></i>Lịch sử đặt phòng</a></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item lock-user text-danger" href="#" data-user-id="@u.Id"><i class="fas fa-lock me-2"></i>Khóa tài khoản</a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                idx++;
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center">
                <div class="pagination-info">
                    Hiển thị <span>1</span> đến <span>5</span> của <span>48</span> khách hàng
                </div>
                <ul class="pagination mb-0">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                            <i class="fas fa-angle-left"></i>
                        </a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">
                            <i class="fas fa-angle-right"></i>
                        </a>
                    </li>
                </ul>
                <div class="items-per-page">
                    <select class="form-select form-select-sm">
                        <option value="10">10 / trang</option>
                        <option value="25">25 / trang</option>
                        <option value="50">50 / trang</option>
                        <option value="100">100 / trang</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Actions Fixed Bar -->
    <div class="bulk-actions-bar" style="display: none;">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <span class="selected-count">5</span> người dùng đã chọn
                </div>
                <div class="bulk-actions">
                    <button class="btn btn-sm btn-outline-primary me-2" id="bulkVerify">
                        <i class="fas fa-check-circle me-1"></i> Xác thực
                    </button>
                    <button class="btn btn-sm btn-outline-success me-2" id="bulkActivate">
                        <i class="fas fa-unlock me-1"></i> Mở khóa
                    </button>
                    <button class="btn btn-sm btn-outline-danger me-2" id="bulkDeactivate">
                        <i class="fas fa-lock me-1"></i> Khóa
                    </button>
                </div>
                <button class="btn btn-sm btn-outline-secondary ms-auto" id="clearSelection">
                    <i class="fas fa-times me-1"></i> Bỏ chọn
                </button>
            </div>
        </div>
    </div>
</div>

<!-- User Detail Modal -->
<div class="modal fade" id="userDetailModal" tabindex="-1" aria-labelledby="userDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userDetailModalLabel">Thông tin chi tiết khách hàng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="user-profile-header">
                    <div class="user-avatar">
                        <span>PT</span>
                    </div>
                    <div class="user-info">
                        <h4>Phạm Tuấn</h4>
                        <div class="user-status">
                            <span class="badge bg-success">Đang hoạt động</span>
                            <span class="badge bg-warning">VIP</span>
                        </div>
                        <p class="user-id">ID: #UID001</p>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="fw-bold">Email:</label>
                            <p>phamtuan@mail.com</p>
                        </div>
                        <div class="mb-3">
                            <label class="fw-bold">Số điện thoại:</label>
                            <p>0912345678</p>
                        </div>
                        <div class="mb-3">
                            <label class="fw-bold">Ngày đăng ký:</label>
                            <p>10/05/2023</p>
                        </div>
                        <div class="mb-3">
                            <label class="fw-bold">Lần đăng nhập cuối:</label>
                            <p>25/11/2023, 15:42:30</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="fw-bold">Địa chỉ:</label>
                            <p>123 Nguyễn Văn Linh, Quận 7, TP. Hồ Chí Minh</p>
                        </div>
                        <div class="mb-3">
                            <label class="fw-bold">Số lần đặt phòng:</label>
                            <p>8</p>
                        </div>
                        <div class="mb-3">
                            <label class="fw-bold">Tổng chi tiêu:</label>
                            <p>64.500.000 VNĐ</p>
                        </div>
                        <div class="mb-3">
                            <label class="fw-bold">Điểm thưởng:</label>
                            <p>1,450 điểm</p>
                        </div>
                    </div>
                </div>

                <div class="booking-history mt-4">
                    <h5>Lịch sử đặt phòng gần đây</h5>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Mã đặt</th>
                                <th>Phòng</th>
                                <th>Ngày nhận - trả</th>
                                <th>Trạng thái</th>
                                <th>Tổng tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>B091-2023</td>
                                <td>Deluxe Hướng Biển</td>
                                <td>10/10/2023 - 13/10/2023</td>
                                <td><span class="badge bg-success">Hoàn thành</span></td>
                                <td>9.000.000 VNĐ</td>
                            </tr>
                            <tr>
                                <td>B075-2023</td>
                                <td>Suite Gia Đình</td>
                                <td>15/09/2023 - 18/09/2023</td>
                                <td><span class="badge bg-success">Hoàn thành</span></td>
                                <td>15.600.000 VNĐ</td>
                            </tr>
                            <tr>
                                <td>B042-2023</td>
                                <td>Executive Business</td>
                                <td>22/07/2023 - 25/07/2023</td>
                                <td><span class="badge bg-success">Hoàn thành</span></td>
                                <td>12.800.000 VNĐ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="user-activity mt-4">
                    <h5>Hoạt động gần đây</h5>
                    <ul class="activity-timeline">
                        <li>
                            <div class="activity-icon bg-primary">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <div class="activity-content">
                                <h6>Đăng nhập</h6>
                                <p>25/11/2023, 15:42:30</p>
                            </div>
                        </li>
                        <li>
                            <div class="activity-icon bg-success">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="activity-content">
                                <h6>Hoàn thành đặt phòng #B091-2023</h6>
                                <p>13/10/2023, 12:00:15</p>
                            </div>
                        </li>
                        <li>
                            <div class="activity-icon bg-info">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="activity-content">
                                <h6>Đặt phòng mới #B091-2023</h6>
                                <p>05/10/2023, 09:15:22</p>
                            </div>
                        </li>
                        <li>
                            <div class="activity-icon bg-warning">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="activity-content">
                                <h6>Đánh giá 5 sao cho phòng Suite Gia Đình</h6>
                                <p>19/09/2023, 14:30:45</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="editUserBtn"><i class="fas fa-edit me-1"></i>Chỉnh sửa</button>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addUserModalLabel">Thêm khách hàng mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="firstName" class="form-label">Tên <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="firstName" name="firstName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="lastName" class="form-label">Họ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="lastName" name="lastName" required>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="col-md-6">
                            <label for="phone" class="form-label">Số điện thoại</label>
                            <input type="tel" class="form-control" id="phone" name="phone">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="password" class="form-label">Mật khẩu <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="password" name="password" required>
                                <button class="btn btn-outline-secondary toggle-password" type="button"><i class="fas fa-eye"></i></button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="confirmPassword" class="form-label">Xác nhận mật khẩu <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                                <button class="btn btn-outline-secondary toggle-password" type="button"><i class="fas fa-eye"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="address" class="form-label">Địa chỉ</label>
                            <textarea class="form-control" id="address" name="address" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="userType" class="form-label">Loại người dùng</label>
                            <select class="form-select" id="userType" name="userType">
                                <option value="normal" selected>Thường</option>
                                <option value="vip">VIP</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="status" class="form-label">Trạng thái</label>
                            <select class="form-select" id="status" name="status">
                                <option value="active" selected>Đang hoạt động</option>
                                <option value="pending">Chưa xác thực</option>
                                <option value="inactive">Bị khóa</option>
                            </select>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="loyaltyPoints" class="form-label">Điểm thưởng</label>
                            <input type="number" class="form-control" id="loyaltyPoints" name="loyaltyPoints" value="0" min="0">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Tùy chọn</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sendWelcomeEmail" name="sendWelcomeEmail" checked>
                                <label class="form-check-label" for="sendWelcomeEmail">
                                    Gửi email chào mừng
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="requirePasswordChange" name="requirePasswordChange">
                                <label class="form-check-label" for="requirePasswordChange">
                                    Yêu cầu đổi mật khẩu khi đăng nhập lần đầu
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="notes" class="form-label">Ghi chú</label>
                            <textarea class="form-control" id="notes" name="notes" rows="2"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="saveUserBtn">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Xác nhận thao tác</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Bạn có chắc chắn muốn thực hiện thao tác này?</p>
                <div class="alert alert-warning" id="warningMessage">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span id="warningText">Cảnh báo: Thao tác này có thể ảnh hưởng đến tài khoản người dùng.</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="confirmActionBtn">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/admin-users.js" asp-append-version="true"></script>
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-users.css" asp-append-version="true" />
}